@page "/categories/{category}/books"
@using BRentals.Hub.Features.Shared.Clients
@using BRentals.DTOs

<section class="hero">
    <div class="hero-body">
        <p class="title">
            @Category
        </p>
        <p class="subtitle">
            See all the books in the @Category category
        </p>
    </div>
</section>

<section class="section pt-0">
    <table class="table is-fullwidth">
        <thead>
        <tr>
            <th>Title</th>
            <th>Authors</th>
            <th>Published</th>
            <th>Metadata</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var book in Books)
        {
            <tr>
                <td>
                    @book.Title
                </td>
                <td>
                    @AuthorsList(@book.Authors)
                </td>
                <td>
                    @book.Published
                </td>
                <td>
                    <div class="tags">
                        <span class="tag is-dark">@book.Id</span>
                        <span class="tag is-link">@book.Category</span>
                    </div>
                </td>
            </tr>
        }
        </tbody>
    </table>
</section>

@code {

    [Parameter]
    public string Category { get; set; } = null!;

    [Inject]
    public IBRentalsApiClient Client { get; set; } = null!;

    private string? Continuation { get; set; }

    private List<BookDto> Books { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        var (isSuccessful, books, continuation) =
            await Client.GetBooksInCategoryAsync(Category);

        if (isSuccessful)
        {
            Books = books;
            Continuation = continuation;
        }

        await base.OnInitializedAsync();
    }

    private static string AuthorsList(string[] authors) =>
        string.Join(",", authors);

}